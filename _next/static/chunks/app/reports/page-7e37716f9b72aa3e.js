(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[882],{8234:function(e,t,i){Promise.resolve().then(i.bind(i,9575))},9575:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return m}});var a=i(7437),d=i(2265),s=i(5258),l=i(7583),o=i.n(l),n=i(4881),r=i.n(n),c=JSON.parse('[{"id":1,"name":"Создано"},{"id":2,"name":"В работе"},{"id":3,"name":"Закрыто"},{"id":4,"name":"На рассмотрении"},{"id":5,"name":"Отклонено"},{"id":6,"name":"Утверждено"}]'),u=JSON.parse('[{"id":1,"territory_id":1,"title":"Незаконная вырубка леса","description":"Замечена вырубка деревьев в заповеднике","creator_id":1,"admin_id":1,"status_id":1,"created_at":"2024-06-01T10:00:00Z","updated_at":"2024-06-02T10:00:00Z","type_incident_id":1,"photos":["1","2"],"classificated_type":{"id":1,"name":"Незаконная вырубка","probability":0.92},"document_id":1,"is_classificated":true,"longitude":54.721123,"latitude":60.123456},{"id":2,"territory_id":2,"title":"Мусор вдоль тропы","description":"Много мусора на тропе к вулкану","creator_id":2,"admin_id":2,"status_id":2,"created_at":"2024-06-03T11:00:00Z","updated_at":"2024-06-04T11:00:00Z","type_incident_id":2,"photos":["3","4"],"classificated_type":{"id":2,"name":"Мусор","probability":0.87},"document_id":2,"is_classificated":true,"longitude":53.450123,"latitude":59.789123},{"id":3,"territory_id":3,"title":"Браконьерство","description":"Замечена охота на охраняемой территории","creator_id":3,"admin_id":3,"status_id":3,"created_at":"2024-06-05T12:00:00Z","updated_at":"2024-06-06T12:00:00Z","type_incident_id":3,"photos":["5","6"],"classificated_type":{"id":3,"name":"Браконьерство","probability":0.95},"document_id":3,"is_classificated":true,"longitude":54.987654,"latitude":60.456789},{"id":4,"territory_id":4,"title":"Загрязнение воды","description":"Слив отходов в реку","creator_id":4,"admin_id":4,"status_id":1,"created_at":"2024-06-07T13:00:00Z","updated_at":"2024-06-08T13:00:00Z","type_incident_id":4,"photos":["7","8"],"classificated_type":{"id":4,"name":"Загрязнение воды","probability":0.89},"document_id":4,"is_classificated":true,"longitude":55.123456,"latitude":61.123456},{"id":5,"territory_id":5,"title":"Незаконная охота","description":"Замечены ловушки для животных","creator_id":5,"admin_id":5,"status_id":2,"created_at":"2024-06-09T14:00:00Z","updated_at":"2024-06-10T14:00:00Z","type_incident_id":5,"photos":["9","10"],"classificated_type":{"id":5,"name":"Незаконная охота","probability":0.91},"document_id":5,"is_classificated":true,"longitude":56.234567,"latitude":61.345678},{"id":6,"territory_id":6,"title":"Загрязнение воздуха","description":"Выбросы вредных веществ в атмосферу","creator_id":6,"admin_id":6,"status_id":3,"created_at":"2024-06-11T15:00:00Z","updated_at":"2024-06-12T15:00:00Z","type_incident_id":6,"photos":["11","12"],"classificated_type":{"id":6,"name":"Загрязнение воздуха","probability":0.93},"document_id":6,"is_classificated":true,"longitude":57.345678,"latitude":61.56789}]'),_=JSON.parse('[{"id":"1","eco_id":1,"data":"base64data1","path_to_photo":"uuid1.jpg"},{"id":"2","eco_id":1,"data":"base64data2","path_to_photo":"uuid2.jpg"},{"id":"3","eco_id":2,"data":"base64data3","path_to_photo":"uuid3.jpg"},{"id":"4","eco_id":2,"data":"base64data4","path_to_photo":"uuid4.jpg"},{"id":"5","eco_id":3,"data":"base64data5","path_to_photo":"uuid5.jpg"},{"id":"6","eco_id":3,"data":"base64data6","path_to_photo":"uuid6.jpg"}]'),p=e=>{let{setSelectedCoordinates:t}=e,[i,l]=(0,d.useState)([]),[n,p]=(0,d.useState)([]),[h,m]=(0,d.useState)([]),[y,j]=(0,d.useState)([]),[b,x]=(0,d.useState)(!1),[g,f]=(0,d.useState)(!1),[v,C]=(0,d.useState)(!1),[S,w]=(0,d.useState)(null),[k,T]=(0,d.useState)(null),[N,B]=(0,d.useState)(null);(0,d.useEffect)(()=>{let e=u.map(e=>({...e,viewed:!1}));l(c),p(e),m(_)},[]);let Z=e=>{j(e),x(!0)},H=()=>{x(!1),j([])},O=(e,t)=>{w(e),B(t),f(!0)},P=()=>{f(!1),w(null),B(null)},F=(e,t)=>{w(e),T(t),C(!0)},J=()=>{C(!1),w(null),T(null)},E=async()=>{if(S&&null!==k)try{await fetch("/api/reports/".concat(S),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status_id:k})});let e=n.map(e=>e.id===S?{...e,status_id:k}:e);p(e),J()}catch(e){console.error("Ошибка при обновлении статуса проверки:",e)}},R=async()=>{if(S&&null!==N)try{await fetch("/api/reports/".concat(S),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({viewed:N})});let e=n.map(e=>e.id===S?{...e,viewed:N}:e);p(e),P()}catch(e){console.error("Ошибка при обновлении статуса просмотра:",e)}},q=d.useMemo(()=>n.map(e=>{var t;return{id:e.id,title:e.title,created_at:e.created_at,status:(null===(t=i.find(t=>t.id===e.status_id))||void 0===t?void 0:t.name)||"Неизвестный статус",coordinates:"".concat(e.latitude,", ").concat(e.longitude),latitude:e.latitude,longitude:e.longitude,photos:e.photos,viewed:e.viewed?"Просмотрено":"Не просмотрено"}}),[n,i]),z=d.useMemo(()=>[{Header:"Просмотрено/Не просмотрено",accessor:"viewed",Cell:e=>{let{cell:{value:t,row:i}}=e;return(0,a.jsx)("div",{onClick:()=>O(i.original.id,"Просмотрено"===i.original.viewed),children:t})}},{Header:"Дата",accessor:"created_at"},{Header:"Тип нарушения",accessor:"title"},{Header:"Координаты",accessor:"coordinates"},{Header:"Фотографии",accessor:"photos",Cell:e=>{let{cell:{value:t}}=e;return(0,a.jsx)("button",{className:r().photoButton,onClick:()=>Z(t),children:"Открыть фото"})}},{Header:"Статус проверки",accessor:"status",Cell:e=>{let{cell:{value:t,row:i}}=e;return(0,a.jsx)("div",{onClick:()=>F(i.original.id,i.original.id),className:r().status,children:t})}},{Header:"Карта",id:"mapButton",Cell:e=>{let{cell:{row:i}}=e;return(0,a.jsx)("button",{className:r().mapButton,onClick:()=>t({latitude:i.original.latitude,longitude:i.original.longitude}),children:"Показать на карте"})}}],[i]),{getTableProps:A,getTableBodyProps:M,headerGroups:G,rows:I,prepareRow:L}=(0,s.useTable)({columns:z,data:q}),Q={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",width:"40%",height:"auto",zIndex:"1000"},overlay:{backgroundColor:"rgba(0, 0, 0, 0.5)"}},V={display:"flex",justifyContent:"flex-end",marginTop:"20px"};return(0,a.jsxs)("div",{children:[(0,a.jsxs)("table",{...A(),className:r().table,children:[(0,a.jsx)("thead",{children:G.map(e=>(0,a.jsx)("tr",{...e.getHeaderGroupProps(),children:e.headers.map(e=>(0,a.jsx)("th",{...e.getHeaderProps(),children:e.render("Header")}))}))}),(0,a.jsx)("tbody",{...M(),children:I.map((e,t)=>(L(e),(0,d.createElement)("tr",{...e.getRowProps(),key:e.id},e.cells.map(e=>(0,a.jsx)("td",{...e.getCellProps(),children:e.render("Cell")})))))})]}),(0,a.jsxs)(o(),{isOpen:b,onRequestClose:H,style:Q,children:[(0,a.jsx)("h2",{children:"Фотографии"}),y.map((e,t)=>(0,a.jsx)("img",{src:e,alt:"Photo ".concat(t+1),className:r().photo},t)),(0,a.jsx)("div",{style:V,children:(0,a.jsx)("button",{onClick:H,className:r().modalButton,children:"Закрыть"})})]}),(0,a.jsxs)(o(),{isOpen:g,onRequestClose:P,style:Q,children:[(0,a.jsx)("h2",{children:"Изменить статус просмотра"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{type:"radio",id:"viewed_true",name:"viewed",value:"true",checked:!0===N,onChange:()=>B(!0)}),(0,a.jsx)("label",{htmlFor:"viewed_true",children:"Просмотрено"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{type:"radio",id:"viewed_false",name:"viewed",value:"false",checked:!1===N,onChange:()=>B(!1)}),(0,a.jsx)("label",{htmlFor:"viewed_false",children:"Не просмотрено"})]}),(0,a.jsxs)("div",{style:V,children:[(0,a.jsx)("button",{onClick:R,className:r().modalButton,children:"Сохранить"}),(0,a.jsx)("button",{onClick:P,className:r().modalButton,children:"Отмена"})]})]}),(0,a.jsxs)(o(),{isOpen:v,onRequestClose:J,style:Q,children:[(0,a.jsx)("h2",{children:"Изменить статус проверки"}),i.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{type:"radio",id:"status_".concat(e.id),name:"status",value:e.id,checked:k===e.id,onChange:()=>T(e.id)}),(0,a.jsx)("label",{htmlFor:"status_".concat(e.id),children:e.name})]},e.id)),(0,a.jsxs)("div",{style:V,children:[(0,a.jsx)("button",{onClick:E,className:r().modalButton,children:"Сохранить"}),(0,a.jsx)("button",{onClick:J,className:r().modalButton,children:"Отмена"})]})]})]})};let h=(0,i(7818).default)(()=>Promise.all([i.e(797),i.e(212),i.e(951)]).then(i.bind(i,4951)),{loadableGenerated:{webpack:()=>[4951]},ssr:!1});var m=()=>{let[e,t]=(0,d.useState)(null);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h,{selectedCoordinates:e}),(0,a.jsx)(p,{setSelectedCoordinates:t})]})}},4881:function(e){e.exports={table:"styles_table__T5s9j",selected:"styles_selected__MAx5S",statusSelect:"styles_statusSelect__8enL_",statusSelectOptions:"styles_statusSelectOptions__XxFFa",photoButton:"styles_photoButton__ZwI__",modalButton:"styles_modalButton__rmBnj",modal:"styles_modal__JzgdP","modal-overlay":"styles_modal-overlay__VzQbC","modal-content":"styles_modal-content__r_Wfo"}}},function(e){e.O(0,[910,520,971,23,744],function(){return e(e.s=8234)}),_N_E=e.O()}]);